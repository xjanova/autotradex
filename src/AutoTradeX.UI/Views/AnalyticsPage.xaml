<UserControl x:Class="AutoTradeX.UI.Views.AnalyticsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF">

    <UserControl.Resources>
        <!-- Card Style -->
        <Style x:Key="AnalyticsCard" TargetType="Border">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#1A1A2E" Offset="0"/>
                        <GradientStop Color="#16162A" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="BorderBrush" Value="#20FFFFFF"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="20"/>
        </Style>

        <!-- Header Style -->
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFFFFF"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <!-- ComboBox Style -->
        <Style x:Key="FilterComboBox" TargetType="ComboBox">
            <Setter Property="Background" Value="#20FFFFFF"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#30FFFFFF"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="MinWidth" Value="140"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- Time Button Style -->
        <Style x:Key="TimeButton" TargetType="Border">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Action Button Style -->
        <Style x:Key="ActionButton" TargetType="Border">
            <Setter Property="Background" Value="#20FFFFFF"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#30FFFFFF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Legend Item Style -->
        <Style x:Key="LegendDot" TargetType="Ellipse">
            <Setter Property="Width" Value="10"/>
            <Setter Property="Height" Value="10"/>
            <Setter Property="Margin" Value="0,0,6,0"/>
        </Style>

        <!-- Premium ScrollBar Thumb Style -->
        <Style x:Key="PremiumScrollBarThumb" TargetType="Thumb">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Grid>
                            <Border x:Name="glowBorder" CornerRadius="5" MinHeight="40" Opacity="0">
                                <Border.Background>
                                    <RadialGradientBrush>
                                        <GradientStop Color="#508B5CF6" Offset="0"/>
                                        <GradientStop Color="#00000000" Offset="1"/>
                                    </RadialGradientBrush>
                                </Border.Background>
                            </Border>
                            <Border x:Name="thumb" CornerRadius="5" MinHeight="40" Width="8" HorizontalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                        <GradientStop Color="#8B5CF6" Offset="0"/>
                                        <GradientStop Color="#7C3AED" Offset="0.3"/>
                                        <GradientStop Color="#6D28D9" Offset="0.7"/>
                                        <GradientStop Color="#8B5CF6" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0.6" Color="#7C3AED"/>
                                </Border.Effect>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="thumb" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                            <GradientStop Color="#A78BFA" Offset="0"/>
                                            <GradientStop Color="#8B5CF6" Offset="0.3"/>
                                            <GradientStop Color="#7C3AED" Offset="0.7"/>
                                            <GradientStop Color="#A78BFA" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="thumb" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="12" ShadowDepth="0" Opacity="0.8" Color="#8B5CF6"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="glowBorder" Property="Opacity" Value="0.5"/>
                            </Trigger>
                            <Trigger Property="IsDragging" Value="True">
                                <Setter TargetName="thumb" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                            <GradientStop Color="#C4B5FD" Offset="0"/>
                                            <GradientStop Color="#A78BFA" Offset="0.3"/>
                                            <GradientStop Color="#8B5CF6" Offset="0.7"/>
                                            <GradientStop Color="#C4B5FD" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="thumb" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="16" ShadowDepth="0" Opacity="1" Color="#A78BFA"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="glowBorder" Property="Opacity" Value="0.8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Premium ScrollBar Style -->
        <Style x:Key="PremiumScrollBar" TargetType="ScrollBar">
            <Setter Property="Width" Value="10"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid x:Name="Root" Width="10" Margin="2,4,6,4">
                            <Border Background="#15FFFFFF" CornerRadius="5" Width="8" HorizontalAlignment="Center">
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="3" ShadowDepth="0" Opacity="0.2" Color="#000000"/>
                                </Border.Effect>
                            </Border>
                            <Track x:Name="PART_Track" IsDirectionReversed="True" Width="10">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.PageUpCommand">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Background="Transparent"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.DecreaseRepeatButton>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.PageDownCommand">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Background="Transparent"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.IncreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource PremiumScrollBarThumb}" Width="8"/>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Premium ScrollViewer Style -->
        <Style x:Key="PremiumScrollViewer" TargetType="ScrollViewer">
            <Setter Property="CanContentScroll" Value="False"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ScrollContentPresenter x:Name="PART_ScrollContentPresenter"
                                                    Grid.Column="0"
                                                    CanContentScroll="False"
                                                    ContentTemplate="{TemplateBinding ContentTemplate}"
                                                    Content="{TemplateBinding Content}"
                                                    Margin="{TemplateBinding Padding}"/>
                            <ScrollBar x:Name="PART_VerticalScrollBar"
                                       Grid.Column="1"
                                       Orientation="Vertical"
                                       Style="{StaticResource PremiumScrollBar}"
                                       Minimum="0"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       Value="{TemplateBinding VerticalOffset}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid Background="Transparent">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with Filters -->
        <Border Grid.Row="0" Padding="0,0,0,20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Title Row -->
                <Grid Grid.Row="0" Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="ðŸ“Š Trade Analytics" FontSize="24" FontWeight="Bold" Foreground="White"/>
                        <TextBlock x:Name="SubtitleText" Text="Select a trading pair to analyze"
                                   FontSize="12" Foreground="#60FFFFFF" Margin="0,4,0,0"/>
                    </StackPanel>

                    <!-- Database Info & Cleanup -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Border Background="#10F59E0B" CornerRadius="8" Padding="10,6" Margin="0,0,10,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ’¾ DB: " FontSize="11" Foreground="#F59E0B"/>
                                <TextBlock x:Name="DbSizeText" Text="0 KB" FontSize="11" Foreground="#F59E0B" FontWeight="Medium"/>
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource ActionButton}" MouseLeftButtonDown="CleanupData_Click"
                                Background="#20EF4444" ToolTip="Clean up old data (keeps last 90 days)">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ—‘ï¸" FontSize="12" Margin="0,0,6,0"/>
                                <TextBlock Text="Cleanup" FontSize="11" Foreground="#EF4444"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Filter Row -->
                <Border Grid.Row="1" Background="#10FFFFFF" CornerRadius="12" Padding="15,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Pair Selector -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,20,0">
                            <TextBlock Text="Trading Pair:" FontSize="12" Foreground="#80FFFFFF"
                                       VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <ComboBox x:Name="PairComboBox" Style="{StaticResource FilterComboBox}"
                                      SelectionChanged="PairComboBox_SelectionChanged">
                                <ComboBoxItem Content="All Pairs" IsSelected="True"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Date Range -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,20,0">
                            <TextBlock Text="From:" FontSize="12" Foreground="#80FFFFFF"
                                       VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <DatePicker x:Name="FromDatePicker" Width="120" Background="#20FFFFFF"
                                        Foreground="White" BorderBrush="#30FFFFFF"
                                        SelectedDateChanged="DatePicker_SelectedDateChanged"/>
                            <TextBlock Text="To:" FontSize="12" Foreground="#80FFFFFF"
                                       VerticalAlignment="Center" Margin="15,0,8,0"/>
                            <DatePicker x:Name="ToDatePicker" Width="120" Background="#20FFFFFF"
                                        Foreground="White" BorderBrush="#30FFFFFF"
                                        SelectedDateChanged="DatePicker_SelectedDateChanged"/>
                        </StackPanel>

                        <!-- Quick Time Range -->
                        <Border Grid.Column="2" Background="#10FFFFFF" CornerRadius="8" Padding="4" HorizontalAlignment="Left">
                            <StackPanel Orientation="Horizontal">
                                <Border x:Name="Time1D" Style="{StaticResource TimeButton}" Background="#7C3AED"
                                        MouseLeftButtonDown="TimeRange_Click" Tag="1D">
                                    <TextBlock Text="1D" FontSize="11" Foreground="White" FontWeight="Medium"/>
                                </Border>
                                <Border x:Name="Time7D" Style="{StaticResource TimeButton}"
                                        MouseLeftButtonDown="TimeRange_Click" Tag="7D">
                                    <TextBlock Text="7D" FontSize="11" Foreground="#80FFFFFF" FontWeight="Medium"/>
                                </Border>
                                <Border x:Name="Time30D" Style="{StaticResource TimeButton}"
                                        MouseLeftButtonDown="TimeRange_Click" Tag="30D">
                                    <TextBlock Text="30D" FontSize="11" Foreground="#80FFFFFF" FontWeight="Medium"/>
                                </Border>
                                <Border x:Name="Time90D" Style="{StaticResource TimeButton}"
                                        MouseLeftButtonDown="TimeRange_Click" Tag="90D">
                                    <TextBlock Text="90D" FontSize="11" Foreground="#80FFFFFF" FontWeight="Medium"/>
                                </Border>
                                <Border x:Name="TimeAll" Style="{StaticResource TimeButton}"
                                        MouseLeftButtonDown="TimeRange_Click" Tag="ALL">
                                    <TextBlock Text="ALL" FontSize="11" Foreground="#80FFFFFF" FontWeight="Medium"/>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!-- Refresh Button -->
                        <Border Grid.Column="3" Style="{StaticResource ActionButton}" MouseLeftButtonDown="Refresh_Click"
                                Background="#207C3AED" Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ”„" FontSize="12" Margin="0,0,6,0"/>
                                <TextBlock Text="Refresh" FontSize="11" Foreground="#7C3AED"/>
                            </StackPanel>
                        </Border>

                        <!-- Export CSV Button -->
                        <Border Grid.Column="4" Style="{StaticResource ActionButton}" MouseLeftButtonDown="ExportCSV_Click"
                                Background="#2010B981">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“¥" FontSize="12" Margin="0,0,6,0"/>
                                <TextBlock Text="Export CSV" FontSize="11" Foreground="#10B981"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Main Price Chart with Trade Markers -->
            <Border Grid.Row="0" Style="{StaticResource AnalyticsCard}" Margin="0,0,0,15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Chart Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Pair Info -->
                        <StackPanel Grid.Column="0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock x:Name="CurrentPairText" Text="All Pairs" FontSize="20" FontWeight="Bold" Foreground="White"/>
                                <Border x:Name="ExchangeBadge" Background="#207C3AED" CornerRadius="4" Padding="8,2"
                                        Margin="10,0,0,0" VerticalAlignment="Center" Visibility="Collapsed">
                                    <TextBlock x:Name="CurrentExchangeText" Text="" FontSize="10" Foreground="#7C3AED"/>
                                </Border>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                <TextBlock x:Name="TradeCountLabel" Text="Total Trades: " FontSize="14" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="FilteredTradeCount" Text="0" FontSize="14" FontWeight="Bold" Foreground="White"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Legend -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Top">
                            <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                                <Ellipse Style="{StaticResource LegendDot}" Fill="#10B981"/>
                                <TextBlock Text="Buy" FontSize="12" Foreground="#80FFFFFF"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                                <Ellipse Style="{StaticResource LegendDot}" Fill="#EF4444"/>
                                <TextBlock Text="Sell" FontSize="12" Foreground="#80FFFFFF"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Style="{StaticResource LegendDot}" Fill="#7C3AED"/>
                                <TextBlock Text="P&amp;L" FontSize="12" Foreground="#80FFFFFF"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>

                    <!-- Price Chart -->
                    <lvc:CartesianChart x:Name="PriceChart" Grid.Row="1"
                                        TooltipPosition="Top"
                                        ZoomMode="X"/>

                    <!-- No Data Message -->
                    <Border x:Name="NoDataOverlay" Grid.Row="1" Background="#80000000" Visibility="Collapsed">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="ðŸ“­" FontSize="48" HorizontalAlignment="Center"/>
                            <TextBlock Text="No trade data available" FontSize="16" Foreground="#80FFFFFF"
                                       HorizontalAlignment="Center" Margin="0,10,0,0"/>
                            <TextBlock Text="Start trading to see analytics here" FontSize="12" Foreground="#50FFFFFF"
                                       HorizontalAlignment="Center" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Bottom Section: P&L Chart + Trade List -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="350"/>
                </Grid.ColumnDefinitions>

                <!-- Cumulative P&L Chart -->
                <Border Grid.Column="0" Style="{StaticResource AnalyticsCard}" Margin="0,0,15,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="ðŸ“ˆ Cumulative P&amp;L" Style="{StaticResource SectionHeader}" Margin="0,0,0,10"/>

                        <lvc:CartesianChart x:Name="PnLChart" Grid.Row="1"/>
                    </Grid>
                </Border>

                <!-- Recent Trades List -->
                <Border Grid.Column="1" Style="{StaticResource AnalyticsCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="ðŸŽ¯ Recent Trades" Style="{StaticResource SectionHeader}"/>
                            <TextBlock x:Name="TradeCountText" Text="(0 trades)" FontSize="12" Foreground="#60FFFFFF"
                                       VerticalAlignment="Bottom" Margin="10,0,0,2"/>
                        </StackPanel>

                        <ScrollViewer Grid.Row="1" Style="{StaticResource PremiumScrollViewer}">
                            <ItemsControl x:Name="TradeMarkersList">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#10FFFFFF" CornerRadius="8" Padding="12" Margin="0,0,0,8"
                                                Cursor="Hand" MouseLeftButtonDown="TradeMarker_Click">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- P&L Icon -->
                                                <Border Grid.Column="0" Width="36" Height="36" CornerRadius="8"
                                                        Background="{Binding PnLBackground}" Margin="0,0,12,0">
                                                    <TextBlock Text="{Binding PnLIcon}" FontSize="16"
                                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>

                                                <!-- Trade Info -->
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding Symbol}" FontSize="12" FontWeight="SemiBold"
                                                                   Foreground="White"/>
                                                        <TextBlock Text="{Binding ExchangeRoute}" FontSize="10" Foreground="#60FFFFFF"
                                                                   Margin="8,0,0,0" VerticalAlignment="Bottom"/>
                                                    </StackPanel>
                                                    <TextBlock Text="{Binding TimeDisplay}" FontSize="10" Foreground="#50FFFFFF" Margin="0,2,0,0"/>
                                                </StackPanel>

                                                <!-- P&L -->
                                                <StackPanel Grid.Column="2" HorizontalAlignment="Right">
                                                    <TextBlock Text="{Binding PnLDisplay}" FontSize="12" FontWeight="Medium"
                                                               Foreground="{Binding PnLColor}" HorizontalAlignment="Right"/>
                                                    <TextBlock Text="{Binding SpreadDisplay}" FontSize="10" Foreground="#60FFFFFF"
                                                               HorizontalAlignment="Right" Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Stats Bar -->
        <Border Grid.Row="2" Background="#10FFFFFF" CornerRadius="12" Padding="20,15" Margin="0,15,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Trades -->
                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <TextBlock Text="Total Trades" FontSize="11" Foreground="#60FFFFFF"/>
                    <TextBlock x:Name="TotalTradesText" Text="0" FontSize="20" FontWeight="Bold" Foreground="White" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Win Rate -->
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="Win Rate" FontSize="11" Foreground="#60FFFFFF"/>
                    <TextBlock x:Name="WinRateText" Text="0%" FontSize="20" FontWeight="Bold" Foreground="#10B981" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Avg Profit -->
                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="Avg Profit" FontSize="11" Foreground="#60FFFFFF"/>
                    <TextBlock x:Name="AvgProfitText" Text="$0.00" FontSize="20" FontWeight="Bold" Foreground="#10B981" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Best Trade -->
                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock Text="Best Trade" FontSize="11" Foreground="#60FFFFFF"/>
                    <TextBlock x:Name="BestTradeText" Text="$0.00" FontSize="20" FontWeight="Bold" Foreground="#10B981" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Worst Trade -->
                <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                    <TextBlock Text="Worst Trade" FontSize="11" Foreground="#60FFFFFF"/>
                    <TextBlock x:Name="WorstTradeText" Text="$0.00" FontSize="20" FontWeight="Bold" Foreground="#EF4444" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Total P&L -->
                <StackPanel Grid.Column="5" HorizontalAlignment="Center">
                    <TextBlock Text="Total P&amp;L" FontSize="11" Foreground="#60FFFFFF"/>
                    <TextBlock x:Name="TotalPnLText" Text="$0.00" FontSize="20" FontWeight="Bold" Foreground="#10B981" Margin="0,4,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Trade Detail Popup -->
        <Grid x:Name="TradeDetailPopup" Grid.RowSpan="3" Visibility="Collapsed">
            <Border Background="#80000000" MouseLeftButtonDown="ClosePopup_Click"/>
            <Border Background="#1A1A2E" CornerRadius="16" Padding="25"
                    Width="450" HorizontalAlignment="Center" VerticalAlignment="Center"
                    BorderBrush="#30FFFFFF" BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.5" Color="#000000"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Popup Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,20">
                        <TextBlock Text="ðŸ“ Trade Details" FontSize="18" FontWeight="Bold" Foreground="White"/>
                        <Border Background="#20FFFFFF" CornerRadius="6" Padding="8,4" HorizontalAlignment="Right"
                                Cursor="Hand" MouseLeftButtonDown="ClosePopup_Click">
                            <TextBlock Text="âœ•" FontSize="14" Foreground="#80FFFFFF"/>
                        </Border>
                    </Grid>

                    <!-- Trade Details -->
                    <StackPanel Grid.Row="1">
                        <!-- P&L Badge -->
                        <Border x:Name="PopupPnLBadge" Background="#2010B981" CornerRadius="8" Padding="15,10" Margin="0,0,0,15">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock x:Name="PopupPnLIcon" Text="ðŸ“ˆ" FontSize="20" Margin="0,0,10,0"/>
                                <TextBlock x:Name="PopupPnLText" Text="+$0.00" FontSize="18" FontWeight="Bold" Foreground="#10B981"/>
                            </StackPanel>
                        </Border>

                        <!-- Details Grid -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Row 1 -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,0,15">
                                <TextBlock Text="Symbol" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupSymbol" Text="-" FontSize="14" Foreground="White" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,0,15">
                                <TextBlock Text="Spread" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupSpread" Text="-" FontSize="14" Foreground="#7C3AED" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>

                            <!-- Row 2 -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,0,15">
                                <TextBlock Text="Buy Exchange" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupBuyExchange" Text="-" FontSize="14" Foreground="#10B981" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,0,0,15">
                                <TextBlock Text="Sell Exchange" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupSellExchange" Text="-" FontSize="14" Foreground="#EF4444" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>

                            <!-- Row 3 -->
                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,0,15">
                                <TextBlock Text="Buy Price" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupBuyPrice" Text="-" FontSize="14" Foreground="White" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,0,0,15">
                                <TextBlock Text="Sell Price" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupSellPrice" Text="-" FontSize="14" Foreground="White" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>

                            <!-- Row 4 -->
                            <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,0,0,15">
                                <TextBlock Text="Amount" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupAmount" Text="-" FontSize="14" Foreground="White" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Row="3" Grid.Column="1" Margin="0,0,0,15">
                                <TextBlock Text="Fee" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupFee" Text="-" FontSize="14" Foreground="#F59E0B" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>

                            <!-- Row 5 -->
                            <StackPanel Grid.Row="4" Grid.Column="0" Margin="0,0,0,15">
                                <TextBlock Text="Time" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupTime" Text="-" FontSize="14" Foreground="White" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Row="4" Grid.Column="1" Margin="0,0,0,15">
                                <TextBlock Text="Execution" FontSize="11" Foreground="#60FFFFFF"/>
                                <TextBlock x:Name="PopupExecution" Text="-" FontSize="14" Foreground="White" FontWeight="Medium" Margin="0,4,0,0"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay" Grid.RowSpan="3" Visibility="Collapsed" Background="#80000000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="â³" FontSize="48" HorizontalAlignment="Center"/>
                <TextBlock Text="Loading data..." FontSize="14" Foreground="White" HorizontalAlignment="Center" Margin="0,10,0,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
